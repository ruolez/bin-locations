<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bin Locations Management</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <h1>Bin Locations Management</h1>
          <nav class="nav-links">
            <a href="/" class="nav-link active">Bin Locations</a>
            <a href="/history" class="nav-link">History</a>
            <a href="/settings" class="nav-link">Settings</a>
          </nav>
        </div>
        <div class="header-right">
          <!-- Dark Mode Toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            title="Toggle theme"
            aria-label="Toggle dark mode"
          >
            <div class="theme-toggle-slider"></div>
          </button>
          <div class="user-profile">
            <div class="user-info">{{ username }}</div>
            <button class="btn-logout" id="logoutBtn">Logout</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="container">
      <div class="card">
        <!-- Toolbar -->
        <div class="toolbar">
          <div class="toolbar-left">
            <div class="search-container">
              <div class="search-box search-box-small">
                <input
                  type="text"
                  id="binSearch"
                  placeholder="Bin"
                  autocomplete="off"
                />
                <button
                  class="search-clear"
                  id="binClear"
                  type="button"
                  aria-label="Clear bin search"
                >
                  ×
                </button>
              </div>
              <div class="search-box search-box-small">
                <input
                  type="text"
                  id="productSearch"
                  placeholder="Product..."
                  autocomplete="off"
                />
                <button
                  class="search-clear"
                  id="productClear"
                  type="button"
                  aria-label="Clear product search"
                >
                  ×
                </button>
              </div>
              <div class="search-box search-box-small">
                <input
                  type="text"
                  id="upcSearch"
                  placeholder="UPC..."
                  autocomplete="off"
                />
                <button
                  class="search-clear"
                  id="upcClear"
                  type="button"
                  aria-label="Clear UPC search"
                >
                  ×
                </button>
              </div>
            </div>
          </div>
          <div class="toolbar-right">
            <!-- View Toggle -->
            <div class="view-toggle">
              <button
                class="view-toggle-btn active"
                data-view="table"
                title="Table view"
              >
                Table
              </button>
              <button
                class="view-toggle-btn"
                data-view="card"
                title="Card view"
              >
                Cards
              </button>
            </div>
            <button
              class="btn btn-secondary btn-icon"
              id="refreshBtn"
              title="Refresh (Ctrl+R)"
            >
              ↻
            </button>
            <button
              class="btn btn-export btn-icon"
              id="exportBtn"
              title="Export to Excel"
            >
              ↓
            </button>
            <button
              class="btn btn-primary"
              id="addNewBtn"
              title="Add new record (Ctrl+N)"
            >
              + Add New Record
            </button>
          </div>
        </div>

        <!-- Top Summary -->
        <div id="topSummary" class="table-summary" style="display: none">
          <div class="summary-item">
            <span class="summary-label">Total Cases:</span>
            <span class="summary-value" id="topTotalCases">0</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Total Items:</span>
            <span class="summary-value" id="topTotalItems">0</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Records Shown:</span>
            <span class="summary-value" id="topRecordCount">0</span>
          </div>
        </div>

        <!-- Table -->
        <div class="table-container">
          <table id="binLocationsTable">
            <thead>
              <tr>
                <th>Bin</th>
                <th>Product Name</th>
                <th>Cases</th>
                <th>Per Case</th>
                <th>Total Qty</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
            <tfoot id="tableFoot" style="display: none">
              <tr class="totals-row">
                <td colspan="2" style="text-align: right">
                  <strong>Totals:</strong>
                </td>
                <td><strong id="footTotalCases">0</strong></td>
                <td></td>
                <td><strong id="footTotalItems">0</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none">
          <div class="empty-state-icon">□</div>
          <h3>No bin locations found</h3>
          <p>Start by adding a new bin location record</p>
          <button class="btn btn-primary" onclick="openAddModal()">
            + Add New Record
          </button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="recordModal">
      <div class="modal">
        <div class="modal-header">
          <h2 id="modalTitle">Add New Record</h2>
        </div>
        <div class="modal-body">
          <form id="recordForm">
            <input type="hidden" id="recordId" />

            <!-- Bin Location -->
            <div class="form-group">
              <label for="binLocationSearch">
                Bin Location *
                <span class="help-icon-wrapper">
                  <span class="help-icon">?</span>
                  <div class="help-tooltip">
                    <div class="help-tooltip-title">Search Tips</div>
                    <div class="help-tooltip-content">
                      <ul>
                        <li>Type any text for standard search</li>
                        <li>
                          Use <span class="help-tooltip-example">%</span> as
                          wildcard for advanced patterns:
                          <ul style="margin-top: 4px">
                            <li>
                              <span class="help-tooltip-example">A%</span> -
                              starts with "A"
                            </li>
                            <li>
                              <span class="help-tooltip-example">%12</span> -
                              ends with "12"
                            </li>
                            <li>
                              <span class="help-tooltip-example">%A%B%</span> -
                              contains both "A" and "B"
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                </span>
              </label>
              <div class="autocomplete-wrapper">
                <input
                  type="text"
                  id="modalBinLocationSearch"
                  placeholder="Search for bin location..."
                  autocomplete="off"
                  required
                />
                <div
                  class="autocomplete-dropdown"
                  id="modalBinLocationDropdown"
                ></div>
              </div>
              <input type="hidden" id="modalBinLocationId" />
              <small>Type to search for a bin location</small>
            </div>

            <!-- Product -->
            <div class="form-group">
              <label for="productSearch">
                Product *
                <span class="help-icon-wrapper">
                  <span class="help-icon">?</span>
                  <div class="help-tooltip">
                    <div class="help-tooltip-title">Search Tips</div>
                    <div class="help-tooltip-content">
                      <ul>
                        <li>Type any text for standard search</li>
                        <li>
                          Use <span class="help-tooltip-example">%</span> as
                          wildcard for advanced patterns:
                          <ul style="margin-top: 4px">
                            <li>
                              <span class="help-tooltip-example">bolt%</span> -
                              starts with "bolt"
                            </li>
                            <li>
                              <span class="help-tooltip-example">%1/2"</span> -
                              ends with '1/2"'
                            </li>
                            <li>
                              <span class="help-tooltip-example"
                                >%bolt%washer%</span
                              >
                              - contains both terms
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                </span>
              </label>
              <div class="autocomplete-wrapper">
                <input
                  type="text"
                  id="modalProductSearch"
                  placeholder="Search for product..."
                  autocomplete="off"
                  required
                />
                <div class="autocomplete-dropdown" id="modalProductDropdown"></div>
              </div>
              <input type="hidden" id="modalProductUPC" />
              <input type="hidden" id="modalProductDescription" />
              <small>Type to search for a product by description</small>
            </div>

            <!-- Qty per Case -->
            <div class="form-group">
              <label for="qtyPerCase">Qty per Case</label>
              <input
                type="number"
                id="qtyPerCase"
                min="0"
                step="1"
                placeholder="0"
              />
              <small
                >Number of units in each case (stored in
                Items_tbl.UnitQty2)</small
              >
            </div>

            <!-- Case Quantity -->
            <div class="form-group">
              <label for="caseQuantity">Case Quantity *</label>
              <input
                type="number"
                id="caseQuantity"
                min="0"
                step="1"
                placeholder="0"
                required
              />
              <small>Number of cases in this bin location</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <div class="keyboard-hint">
            <kbd>ESC</kbd> to cancel <kbd>Enter</kbd> to save
          </div>
          <button
            class="btn btn-secondary"
            onclick="closeModal()"
            data-modal-close
          >
            Cancel
          </button>
          <button
            class="btn btn-primary"
            id="saveRecordBtn"
            onclick="saveRecord()"
          >
            Save
          </button>
        </div>
      </div>
    </div>

    <!-- Adjust Quantity Modal -->
    <div class="modal-overlay" id="adjustModal">
      <div class="modal">
        <div class="modal-header">
          <h2 id="adjustModalTitle">Adjust Case Quantity</h2>
        </div>
        <div class="modal-body">
          <form id="adjustForm">
            <input type="hidden" id="adjustRecordId" />

            <div class="form-group">
              <label>Current Case Quantity</label>
              <input type="text" id="currentQuantity" readonly disabled />
            </div>

            <div class="form-group">
              <label for="adjustAmount">Adjustment Amount *</label>
              <input
                type="number"
                id="adjustAmount"
                step="1"
                placeholder="Enter positive or negative number"
                required
              />
              <small
                >Enter positive number to add cases, negative to remove
                cases</small
              >
            </div>

            <div class="form-group">
              <label for="adjustNotes">
                Notes
                <span class="optional-label">(optional)</span>
              </label>
              <textarea
                id="adjustNotes"
                placeholder="Enter reason for adjustment (e.g., 'damaged goods', 'inventory correction')"
                maxlength="500"
              ></textarea>
              <div class="char-counter">
                <span id="notesCharCount">0</span> / 500
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <div class="keyboard-hint">
            <kbd>ESC</kbd> to cancel <kbd>Enter</kbd> to save
          </div>
          <button
            class="btn btn-secondary"
            onclick="closeAdjustModal()"
            data-modal-close
          >
            Cancel
          </button>
          <button class="btn btn-primary" onclick="saveAdjustment()">
            Save
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
      <div class="modal">
        <div class="modal-header">
          <h2>Confirm Delete</h2>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 16px">
            Are you sure you want to delete this record? This action cannot be
            undone.
          </p>
          <input type="hidden" id="deleteRecordId" />
          <div
            style="
              background: var(--background);
              padding: 12px;
              border-radius: 4px;
              border-left: 4px solid var(--error);
            "
          >
            <div style="margin-bottom: 8px">
              <strong>Bin Location:</strong>
              <span id="deleteBinLocation"></span>
            </div>
            <div style="margin-bottom: 8px">
              <strong>Product:</strong> <span id="deleteProductName"></span>
            </div>
            <div>
              <strong>Case Quantity:</strong> <span id="deleteCaseQty"></span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="keyboard-hint">
            <kbd>ESC</kbd> to cancel <kbd>Enter</kbd> to confirm
          </div>
          <button
            class="btn btn-secondary"
            onclick="closeDeleteModal()"
            data-modal-close
          >
            Cancel
          </button>
          <button class="btn btn-error" onclick="confirmDelete()">
            Confirm Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none">
      <div class="spinner"></div>
      <div>Loading...</div>
    </div>

    <!-- Load theme manager first -->
    <script src="/static/js/theme.js"></script>
    <!-- Load keyboard manager -->
    <script src="/static/js/keyboard.js"></script>
    <!-- Load main app script -->
    <script src="/static/js/app.js"></script>
  </body>
</html>
